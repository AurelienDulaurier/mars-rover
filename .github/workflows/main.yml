name: GitHub Actions
run-name: ${{ github.actor }} is testing out GitHub Actions üöÄ
on: [push]
jobs:
  Explore-GitHub-Actions:
    runs-on: ubuntu-latest
    steps:
      
    - name: Checkout
      uses: actions/checkout@v4
      with:
        fetch-depth: 0

    - name: Check commit message
      id: check_commit
      run: |
          REQUIRED_EMOJI="üöÄ|üëΩ|ü™ê"
          if ! git log -1 --pretty=%B | grep -E -q "$REQUIRED_EMOJI"; then
            echo "Erreur : Le dernier commit doit contenir l'emoji $REQUIRED_EMOJI."
            echo "::set-output name=success::false"
            exit 1
          fi
          echo "::set-output name=success::true"

    # Installer le .NET Core workload
    - name: Install .NET Core
      uses: actions/setup-dotnet@v4
      with:
        dotnet-version: 8.0.x

    # Mettre en cache les d√©pendances .NET
    - name: Cache NuGet packages
      uses: actions/cache@v3
      with:
        path: ~/.nuget/packages
        key: ${{ runner.os }}-nuget-${{ hashFiles('**/*.csproj') }}
        restore-keys: |
          ${{ runner.os }}-nuget-
    
    # Ex√©cuter tous les tests unitaires dans la solution
    - name: Execute unit tests
      run: dotnet test

    # Envoyer une notification Slack Success
    - name: Notify Slack Success
      if: steps.check_commit.outputs.success == 'true'
      run: |
        RANDOM_MESSAGE=$(echo -e "‚úÖ Le commit a r√©ussi !\nüéâ Bravo, tout fonctionne !\nüåü Ex√©cution r√©ussie !" | shuf -n 1)
        curl -X POST -H 'Content-type: application/json' --data "{
          \"text\": \"$RANDOM_MESSAGE\",
          \"attachments\": [
            {
              \"image_url\": \"https://media.giphy.com/media/3o7aD2sa7Y8g3g1h8I/giphy.gif\",
              \"alt_text\": \"Soleil\"
            }
          ]
        }" ${{ secrets.SLACK_WEBHOOK_URL }}

    # Envoyer une notification Slack Failure
    - name: Notify Slack Failure
      if: steps.check_commit.outputs.success == 'false'
      run: |
        RANDOM_MESSAGE=$(echo -e "‚ö†Ô∏è Le commit a √©chou√©.\nüö´ Oups, quelque chose ne va pas !\nüò¢ √âchec de l'ex√©cution." | shuf -n 1)
        curl -X POST -H 'Content-type: application/json' --data "{
          \"text\": \"$RANDOM_MESSAGE\",
          \"attachments\": [
            {
              \"image_url\": \"https://media.giphy.com/media/3o7aD2sa7Y8g3g1h8I/giphy.gif\",
              \"alt_text\": \"Orage\"
            }
          ]
        }" ${{ secrets.SLACK_WEBHOOK_URL }}
